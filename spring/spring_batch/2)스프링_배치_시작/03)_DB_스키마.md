# Spring Batch DB μ¤ν‚¤λ§ 


## DB μ¤ν‚¤λ§ μƒμ„± 

<br>

1. μ¤ν”„λ§ λ°°μΉ λ©”νƒ€ λ°μ΄ν„°

    - μ¤ν”„λ§ λ°°μΉμ μ‹¤ν–‰ λ° κ΄€λ¦¬λ¥Ό μ„ν• λ©μ μΌλ΅ μ—¬λ¬ λ„λ©”μΈλ“¤ (Job, Step, jobParameters..) μ μ •λ³΄λ“¤μ„ `μ €μ¥, μ—…λ°μ΄νΈ, μ΅°ν`ν•  μ μλ” μ¤ν‚¤λ§λ¥Ό μ κ³µ 

    - κ³Όκ±°, ν„μ¬μ μ‹¤ν–‰μ— λ€ν• μ„Έμ„Έν• μ •λ³΄, μ‹¤ν–‰μ— λ€ν• μ„±κ³µκ³Ό μ‹¤ν¨ μ—¬λ¶€ λ“±μ„ μΌλ©μ”μ—°ν•κ² κ΄€λ¦¬ν•¨μΌλ΅μ„ λ°°μΉ μ΄μ©μ— μμ–΄ λ¦¬μ¤ν¬ λ°μƒμ‹ λΉ λ¥Έ λ€μ²κ°€ κ°€λ¥

    - DBμ™€ μ—°λ™ν•  κ²½μ° `ν•„μμ ` μΌλ΅ λ©”νƒ€ ν…μ΄λΈ”μ΄ μƒμ„±λμ–΄μ•Ό ν•¨.

        - λ©”νƒ€ ν…μ΄λΈ”μ΄ μ—†μ„ κ²½μ°, μ–΄ν”λ¦¬μΌ€μ΄μ… κµ¬λ™μ΄ λμ§€ μ•λ”λ‹¤.

<br>

2. DB μ¤ν‚¤λ§ μ κ³µ

    - sql νμΌ μ„μΉ : `/org/springframework/batch/core/schema-*.sql`

    - DB μ ν•λ³„λ΅ μ κ³µμ΄ λμ–΄ μλ‹¤.

<br>

3. μ¤ν‚¤λ§ μƒμ„± μ„¤μ •

    - μλ™ μƒμ„± - μΏΌλ¦¬ λ³µμ‚¬ ν›„ μ§μ ‘ μ‹¤ν–‰

    - μλ™ μƒμ„± - `spring.batch.jdbc.initialize-schema` μ„¤μ • (`application.yml` νμΌμ— μ„¤μ •)

        - `ALWAYS`

            - μ¤ν¬λ¦½νΈ ν•­μƒ μ‹¤ν–‰

            - RDBMS μ„¤μ •μ΄ λμ–΄ μμ„ κ²½μ°, λ‚΄μ¥ DBλ³΄λ‹¤ μ°μ„ μ μΌλ΅ μ‹¤ν–‰

        - `EMBEDDED` 

            - λ‚΄μ¥ DB μΌ λ•λ§ μ‹¤ν–‰λλ©° μ¤ν‚¤λ§κ°€ μλ™ μƒμ„±λλ‹¤. (κΈ°λ³Έκ°’)

        - `NEVER`

            - μ¤ν¬λ¦½νΈ ν•­μƒ μ‹¤ν–‰ μ•ν•¨

            - λ‚΄μ¥ DB μΌκ²½μ° μ¤ν¬λ¦½νΈκ°€ μƒμ„±μ΄ μ•λκΈ° λ•λ¬Έμ— μ¤λ¥κ°€ λ°μƒ

            - π’΅ μ΄μμ—μ„λ” μλ™μΌλ΅ μ¤ν¬λ¦½νΈ μƒμ„± ν›„ `NEVER`λ΅ μ„¤μ •ν•λ” κ²ƒμ„ κ¶ν•¨ 

<br>

## μ¤ν”„λ§ λ°°μΉ λ©”νƒ€ λ°μ΄ν„° ν…μ΄λΈ” 

![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2022-10-22 α„‹α…©α„’α…® 8 32 25](https://user-images.githubusercontent.com/74750901/197339504-5096fd89-a24a-4a3f-b82b-a1ebd6a62c12.png)

<br>

### Job κ΄€λ ¨ ν…μ΄λΈ”

<br>

1. BATCH_JOB_INSTANCE

    - Job μ΄ μ‹¤ν–‰λ  λ• `JobInstance μ •λ³΄`κ°€ μ €μ¥λλ©° job_name κ³Ό job_key λ¥Ό ν‚¤λ΅ ν•μ—¬ ν•λ‚μ λ°μ΄ν„°κ°€ μ €μ¥

    - λ™μΌν• job_name κ³Ό job_key λ΅ μ¤‘λ³µ μ €μ¥λ  μ μ—†λ‹¤. 

    - columns 

        - JOB_INSTANCE_ID : μ‹λ³„ ν‚¤

        - VERSION : μ—…λ°μ΄νΈ λ  λ• λ§λ‹¤ 1μ”© μ¦κ°€

        - JOB_NAME : Job μ„ κµ¬μ„±ν•  λ• λ¶€μ—¬ν•λ” job μ μ΄λ¦„

        - JOB_KEY : job_name κ³Ό jobParameterλ¥Ό ν•©μ³ ν•΄μ‹±ν• κ°’μ„ μ €μ¥

<br>

2. BATCH_JOB_EXECUTION

    - `job μ μ‹¤ν–‰ μ •λ³΄`κ°€ μ €μ¥λλ©° job μƒμ„±, μ‹μ‘, μΆ…λ£ μ‹κ°„, μ‹¤ν–‰μƒνƒ, λ©”μ‹μ§€ λ“±μ„ κ΄€λ¦¬ 

    - columns

        - JOB_EXECUTION_ID : μ‹λ³„ ν‚¤. BATCH_JOB_INSTANCE μ™€ μΌλ€λ‹¤ κ΄€κ³„

        - VERSION : μ—…λ°μ΄νΈ λ  λ•λ§λ‹¤ 1μ”© μ¦κ°€

        - JOB_INSTANCE_ID : BATCH_JOB_INSTANCE μ ν‚¤ μ €μ¥ (FK)

        - CREATE_TIME : μ‹¤ν–‰ (Execution) μ΄ μƒμ„±λ μ‹μ 

        - START_TIME : μ‹¤ν–‰ (Execution) μ΄ μ‹μ‘λ μ‹μ 

        - END_TIME : μ‹¤ν–‰ (Execution) μ΄ μΆ…λ£λ μ‹μ 

            - Job μ‹¤ν–‰ λ„μ¤‘ μ¤λ¥ λ°μƒ ν•μ—¬ Job μ΄ μ¤‘λ‹¨λ κ²½μ° μ €μ¥λμ§€ μ•μ„ μ μμ (μ΄ κ²½μ° null κ°’μ΄ μ €μ¥λλ‹¤. )

        - STATUS : μ‹¤ν–‰ μƒνƒ (BatchStatus) λ¥Ό μ €μ¥ 

            - COMPLETED, FAILED, STOPPED ...

        - EXIT_CODE : μ‹¤ν–‰ μΆ…λ£ μ½”λ“ (ExitStatus) λ¥Ό μ €μ¥

            - COMPLETED, FAILED ...

        - EXIT_MESSAGE : STATUS κ°€ μ‹¤ν¨μΌ κ²½μ° μ‹¤ν¨ μ›μΈ λ“±μ λ‚΄μ©μ„ μ €μ¥

        - LAST_UPDATED : λ§μ§€λ§‰ μ‹¤ν–‰ (Execution) μ μ‹μ 

        - JOB_CONFIGURATION_LOCATION

<br>


3. BATCH_JOB_EXECUTION_PARAMS

    - job κ³Ό ν•¨κ» μ‹¤ν–‰λλ” `JobParameter μ •λ³΄`λ¥Ό μ €μ¥

    - columns

        - JOB_EXECTUION_ID : μ‹λ³„ ν‚¤. BATCH_JOB_EXECUTION κ³Όλ” μΌλ€λ‹¤ κ΄€κ³„

        - TYPE_CD : STRING, LONG, DATE, DOUBLE νƒ€μ… μ •λ³΄

            - JOB_PARAMETER κ°€ 4κ°€μ§€ νƒ€μ…μΌλ΅ μ κ³µμ΄ κ°€λ¥ν•λ‹¤. 

        - KEY_NAME : νλΌλ―Έν„° ν‚¤ κ°’

        - STRING_VAL : νλΌλ―Έν„° λ¬Έμ κ°’

        - DATE_VAL : νλΌλ―Έν„° λ‚ μ§ κ°’
        
        - LONG_VAL : νλΌλ―Έν„° LONG κ°’

        - DOUBLE_VAL : νλΌλ―Έν„° DOUBLE κ°’

        - IDENTIFYING : μ‹λ³„ μ—¬λ¶€ (TRUE, FALSE)

<br>


4. BATCH_JOB_EXECUTION_CONTEXT

    - job μ μ‹¤ν–‰λ™μ• μ—¬λ¬κ°€μ§€ `μƒνƒ μ •λ³΄, κ³µμ  λ°μ΄ν„°λ¥Ό μ§λ ¬ν™” (Json ν•μ‹)` ν•΄μ„ μ €μ¥

    - step κ°„ μ„λ΅ κ³µμ κ°€ κ°€λ¥ν•¨ 

    - columns

        - JOB_EXECUTION_ID : μ‹λ³„ ν‚¤. JOB_EXECUTION λ§λ‹¤ κ° μƒμ„±

        - SHORT_CONTEXT : Job μ μ‹¤ν–‰ μƒνƒ μ •λ³΄, κ³µμ  λ°μ΄ν„° λ“±μ μ •λ³΄λ¥Ό λ¬Έμμ—΄λ΅ μ €μ¥

        - SERIALIZED_CONTEXT : μ§λ ¬ν™”λ μ „μ²΄ μ»¨ν…μ¤νΈ

<br>


### Step κ΄€λ ¨ ν…μ΄λΈ” 

<br>

1. BATCH_STEP_EXECUTION

    - `step μ μ‹¤ν–‰μ •λ³΄`κ°€ μ €μ¥λλ©° μƒμ„±, μ‹μ‘, μΆ…λ£ μ‹κ°„, μ‹¤ν–‰μƒνƒ, λ©”μ‹μ§€ λ“±μ„ κ΄€λ¦¬ 

    - columns

        ![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2022-10-22 α„‹α…©α„’α…® 11 52 30](https://user-images.githubusercontent.com/74750901/197396261-9dc57cba-5020-4d2a-86e5-ca97f532520b.png)


<br>

2. BATCH_STEP_EXECUTION_CONTEXT

    - step μ μ‹¤ν–‰λ™μ• μ—¬λ¬κ°€μ§€ `μƒνƒ μ •λ³΄, κ³µμ  λ°μ΄ν„°λ¥Ό μ§λ ¬ν™” (Json ν•μ‹)` ν•΄μ„ μ €μ¥ 

    - Step λ³„λ΅ μ €μ¥λλ©° Step κ°„ `μ„λ΅ κ³µμ ν•  μ μ—†μ `

    - columns 

        - STEP_EXECUTION_ID : μ‹λ³„ ν‚¤. STEP_EXECUTION λ§λ‹¤ κ° μƒμ„±

        - SHORT_CONTEXT : Step μ μ‹¤ν–‰ μƒνƒ μ •λ³΄, κ³µμ  λ°μ΄ν„° λ“±μ μ •λ³΄λ¥Ό λ¬Έμμ—΄λ΅ μ €μ¥

        - SERIALIZED_CONTEXT : μ§λ ¬ν™”λ μ „μ²΄ μ»¨ν…μ¤νΈ


